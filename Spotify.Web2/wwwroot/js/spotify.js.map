{"version":3,"file":"spotify.js","sourceRoot":"","sources":["../ts/spotify.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference path=\"../lib/jquery/dist/jquery.d.ts\" />\r\n/// <reference path=\"../lib/jqgrid/jqGrid.d.ts\" />\r\n\r\nvar actions = {\r\n    groups: {\r\n        open(groupId) {\r\n            router.open(\"/Spotify/Groups\", { groupId: groupId })\r\n        }\r\n    }\r\n}\r\n\r\nvar colModels = {\r\n    track: {\r\n        id() { return { hidden: true, name: \"Id\" } as ColModelOptions },\r\n        name() { return { name: \"Name\", label: \"Track\" } as ColModelOptions },\r\n        image() {\r\n            return {\r\n                name: \"Album.Images\", label: \"Image\",\r\n                formatter: (cellValue, info, model, action) => {\r\n                    var html = `<img src=${cellValue[2].Url} />`\r\n                    return html\r\n                }\r\n            } as ColModelOptions\r\n        },\r\n    },\r\n    group: {\r\n        groupId() { return { hidden: true, name: \"GroupId\" } as ColModelOptions },\r\n        itemId() { return { hidden: true, name: \"ItemId\" } as ColModelOptions },\r\n        groupName() { return { name: \"GroupName\", label: \"Group\" } as ColModelOptions },\r\n        numberOfTracks() {\r\n            return {\r\n                name: \"TrackCount\", label: \"Tracks\"\r\n            } as ColModelOptions\r\n        },\r\n        isMember() {\r\n            return {\r\n                name: \"IsMember\", label: \"Is Member\", width: 20,\r\n                formatter: (cellValue, info, model, action) => {\r\n\r\n                    var trackId = $(\"#trackId\").val()\r\n\r\n                    var cellConfig = cellValue ?\r\n                        { icon: \"fa-minus fa-lg\", action: `spotify.removeTrackFromGroup('${info.rowId}', ${model.GroupId}, '${trackId}')` } :\r\n                        { icon: \"fa-plus fa-lg\", action: `spotify.addTrackToGroup('${info.rowId}', ${model.GroupId}, '${trackId}')` }\r\n\r\n                    return `<span class=\"toggle\"><i class='fa ${cellConfig.icon}' data-next-icon=\"\" onclick=\"${cellConfig.action}\"></i></span>`\r\n                }\r\n            } as ColModelOptions\r\n        },\r\n\r\n        actions(options: {\r\n            open?: boolean\r\n        }) {\r\n            return {\r\n                name: \"Actions\", width: 20,\r\n                formatter: (cellValue, info, model, action) => {\r\n                    var iconStrings = \"\"\r\n\r\n                    if (options.open) {\r\n                        iconStrings += `<i class='fa fa-info' title='Open' onclick='actions.groups.open(${model.GroupId})'></i>`\r\n                    }\r\n\r\n                    return \"<span>\" + iconStrings + \"</span>\"\r\n                }\r\n            } as ColModelOptions\r\n        }\r\n    }\r\n}\r\n\r\nvar spotify = {\r\n\r\n    openTrack(trackId: string) {\r\n        router.open(\"/Spotify/Track\", { trackId: trackId })\r\n    },\r\n    openGroup(groupId: string) {\r\n        router.open(\"/Spotify/Groups\", { groupId: groupId })\r\n    },\r\n\r\n    addTrackToGroup(rowId: number, groupId: number, trackId: string) {\r\n        $.ajax({\r\n            url: router.route(\"/Spotify/AddTrackToGroup\"),\r\n            type: \"POST\",\r\n            data: {\r\n                groupId: groupId,\r\n                trackId: trackId\r\n            },\r\n            success: (response) => {\r\n                var $trackGroupsGrid = $(\"#trackGroupsGrid\")\r\n                $trackGroupsGrid.jqGrid(\"getLocalRow\", rowId).IsMember = true\r\n                $trackGroupsGrid.trigger(\"reloadGrid\")\r\n            }\r\n        })\r\n    },\r\n    removeTrackFromGroup(rowId: number, groupId: number, trackId: string) {\r\n        $.ajax({\r\n            url: router.route(\"/Spotify/RemoveTrackFromGroup\"),\r\n            type: \"POST\",\r\n            data: {\r\n                groupId: groupId,\r\n                trackId: trackId\r\n            },\r\n            success: (response) => {\r\n                var $trackGroupsGrid = $(\"#trackGroupsGrid\")\r\n                $trackGroupsGrid.jqGrid(\"getLocalRow\", rowId).IsMember = false\r\n                $trackGroupsGrid.trigger(\"reloadGrid\")\r\n            }\r\n        })\r\n    },\r\n\r\n    loadCurrentlyPlaying() {\r\n        $.ajax({\r\n            url: \"/Spotify/GetCurrentlyPlaying\",\r\n            type: \"POST\",\r\n            success: (response) => {\r\n\r\n                //console.debug(\"CurrentlyPlaying:\", response)\r\n                var $currentlyPlaying = $(\"#currently-playing\")\r\n\r\n                if (response === null) {\r\n                    //console.debug(\"Nothing is playing, removing image\")\r\n                    $currentlyPlaying.html(\"\")\r\n                }\r\n                else if ($currentlyPlaying.attr(\"data-uri\") === response.Item.Uri) {\r\n                    //console.debug(\"Currently playing image is already set\")\r\n                } else {\r\n                    //console.debug(\"Currently playing image needs to be set again\")\r\n                    $currentlyPlaying.html(\"\")\r\n                    $currentlyPlaying.attr(\"data-uri\", response.Item.Uri)\r\n                        .append(\"<img>\").children(\"img\")\r\n                        .attr(\"src\", response.Item.Album.Images[1].Url)\r\n                        .attr(\"alt\", response.Item.Name)\r\n                        .attr(\"title\", response.Item.Name)\r\n                        .attr(\"width\", 120)\r\n                        .attr(\"height\", 120)\r\n                        .click(() => spotify.openTrack(response.Item.Id))\r\n                }\r\n            },\r\n            error: (error) => {\r\n                console.error(error)\r\n            }\r\n        })\r\n    },\r\n    page: {\r\n        groupSingle: {\r\n            init() {\r\n                var $tracksGrid = $(\"#tracksGrid\").jqGrid(helpers.createGridModel({\r\n                    url: router.route(\"/Spotify/CachedTracks\"),\r\n                    colModel: [\r\n                        colModels.track.id(),\r\n                        colModels.track.image(),\r\n                        colModels.track.name()\r\n                    ]\r\n                }))\r\n\r\n                helpers.grid.resizeGridOnWindowResize($tracksGrid)\r\n            }\r\n        },\r\n        trackSingle: {\r\n            init() {\r\n                var $trackGroupsGrid = $(\"#trackGroupsGrid\").jqGrid(helpers.createGridModel({\r\n                    url: router.route(\"/Spotify/CachedGroups\"),\r\n                    colModel: [\r\n                        colModels.group.groupId(),\r\n                        colModels.group.itemId(),\r\n                        colModels.group.actions({ open: true }),\r\n                        colModels.group.groupName(),\r\n                        colModels.group.isMember() \r\n                    ]\r\n                }))\r\n                helpers.grid.setGridWidthToParentWidth($trackGroupsGrid)\r\n\r\n                var $recommendationsGrid = $(\"#recommendationsGrid\").jqGrid(helpers.createGridModel({\r\n                    url: router.route(\"/Spotify/CachedRecommendations\"),\r\n                    colModel: [\r\n                        colModels.track.id(),\r\n                        colModels.track.name(),\r\n                        colModels.track.image()\r\n                    ]\r\n                }))\r\n\r\n                helpers.grid.setGridWidthToParentWidth($recommendationsGrid)\r\n                $recommendationsGrid.jqGrid(\"setGridHeight\", 500)\r\n            }\r\n        },\r\n        groupsMultiple: {\r\n            init() {\r\n                var $groupsGrid = $(\"#groupsGrid\").jqGrid(helpers.createGridModel({\r\n                    url: router.route(\"/Spotify/CachedGroups\"),\r\n                    colModel: [\r\n                        colModels.group.groupId(),\r\n                        colModels.group.itemId(),\r\n                        colModels.group.actions({ open: true }),\r\n                        colModels.group.groupName(),\r\n                        colModels.group.numberOfTracks()\r\n                    ]\r\n                }))\r\n\r\n                helpers.grid.resizeGridOnWindowResize($groupsGrid)\r\n            }\r\n        }\r\n    },\r\n    init() {\r\n        helpers.interval.set(spotify.loadCurrentlyPlaying, config.loadCurrentlyPlayingInterval)\r\n    }\r\n}\r\n\r\n"]}